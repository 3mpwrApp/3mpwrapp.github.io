!function(){"use strict";function e(n){9===n.keyCode&&(document.body.classList.add("user-is-tabbing"),window.removeEventListener("keydown",e),window.addEventListener("mousedown",t))}function t(){document.body.classList.remove("user-is-tabbing"),window.removeEventListener("mousedown",t),window.addEventListener("keydown",e)}window.addEventListener("keydown",e);const n=document.getElementById("dyslexic-font-toggle");n&&("true"===localStorage.getItem("dyslexicFont")&&(document.body.setAttribute("data-font","dyslexic"),n.checked=!0),n.addEventListener("change",function(){this.checked?(document.body.setAttribute("data-font","dyslexic"),localStorage.setItem("dyslexicFont","true"),announce("Dyslexia-friendly font enabled")):(document.body.removeAttribute("data-font"),localStorage.setItem("dyslexicFont","false"),announce("Default font restored"))}));const o=document.getElementById("reading-guide-toggle");let d=null;function i(e){d&&(d.style.top=e.clientY+"px")}o&&(o.addEventListener("change",function(){this.checked?(d||(d=document.createElement("div"),d.className="reading-ruler",d.setAttribute("aria-hidden","true"),document.body.appendChild(d)),document.body.setAttribute("data-reading-guide","ruler"),document.addEventListener("mousemove",i),localStorage.setItem("readingGuide","true"),announce("Reading guide enabled - ruler follows your mouse")):(document.body.removeAttribute("data-reading-guide"),document.removeEventListener("mousemove",i),d&&(d.style.display="none"),localStorage.setItem("readingGuide","false"),announce("Reading guide disabled"))}),"true"===localStorage.getItem("readingGuide")&&(o.checked=!0,o.dispatchEvent(new Event("change"))));const a=document.getElementById("bionic-reading-toggle");a&&(a.addEventListener("change",function(){this.checked?(document.body.setAttribute("data-reading","bionic"),localStorage.setItem("bionicReading","true"),announce("Bionic reading enabled - first letters emphasized")):(document.body.removeAttribute("data-reading"),localStorage.setItem("bionicReading","false"),announce("Bionic reading disabled"))}),"true"===localStorage.getItem("bionicReading")&&(a.checked=!0,a.dispatchEvent(new Event("change"))));const r=document.getElementById("line-focus-toggle");r&&(r.addEventListener("change",function(){this.checked?(document.body.setAttribute("data-reading","line-focus"),localStorage.setItem("lineFocus","true"),announce("Line focus mode enabled - hover over text to highlight")):(document.body.removeAttribute("data-reading"),localStorage.setItem("lineFocus","false"),announce("Line focus mode disabled"))}),"true"===localStorage.getItem("lineFocus")&&(r.checked=!0,r.dispatchEvent(new Event("change"))));const c=document.getElementById("voice-labels-toggle");function s(){document.querySelectorAll("form").forEach(function(e){e.querySelectorAll("input, select, textarea").forEach(function(t){const n=e.querySelector('label[for="'+t.id+'"]');n&&!t.hasAttribute("aria-label")&&(t.setAttribute("aria-labelledby",n.id||"label-"+Math.random().toString(36).substr(2,9)),n.id||(n.id=t.getAttribute("aria-labelledby"))),t.addEventListener("blur",function(){t.validity.valid?(t.setAttribute("aria-invalid","false"),t.classList.remove("form-error"),t.classList.add("form-success"),u(t)):(t.setAttribute("aria-invalid","true"),t.classList.add("form-error"),t.classList.remove("form-success"),l(t))}),t.addEventListener("focus",function(){t.classList.remove("form-error","form-success"),u(t)})}),e.addEventListener("submit",function(t){const n=e.querySelectorAll("[required]");let o=!0;if(n.forEach(function(e){e.validity.valid||(o=!1,e.setAttribute("aria-invalid","true"),e.classList.add("form-error"),l(e))}),!o){t.preventDefault(),announce("Please fix the errors in the form before submitting");const n=e.querySelector(".form-error");n&&n.focus()}})})}function l(e){u(e);const t=document.createElement("div");t.className="error-message-text",t.id=e.id+"-error",t.setAttribute("role","alert"),e.validity.valueMissing?t.textContent="This field is required":e.validity.typeMismatch?t.textContent="Please enter a valid "+e.type:e.validity.tooShort?t.textContent="Please enter at least "+e.minLength+" characters":e.validity.tooLong?t.textContent="Please enter no more than "+e.maxLength+" characters":t.textContent="Please check this field",e.setAttribute("aria-describedby",t.id),e.parentNode.insertBefore(t,e.nextSibling)}function u(e){const t=document.getElementById(e.id+"-error");t&&(t.remove(),e.removeAttribute("aria-describedby"))}c&&(c.addEventListener("change",function(){this.checked?(document.body.setAttribute("data-show-voice-labels","true"),localStorage.setItem("voiceLabels","true"),announce("Voice command labels enabled")):(document.body.removeAttribute("data-show-voice-labels"),localStorage.setItem("voiceLabels","false"),announce("Voice command labels disabled"))}),"true"===localStorage.getItem("voiceLabels")&&(c.checked=!0,c.dispatchEvent(new Event("change")))),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),document.querySelectorAll(".skip-link").forEach(function(e){e.addEventListener("click",function(t){t.preventDefault();const n=e.getAttribute("href").substring(1),o=document.getElementById(n);o&&(o.hasAttribute("tabindex")||o.setAttribute("tabindex","-1"),o.focus(),o.scrollIntoView({behavior:"smooth",block:"start"}),announce("Skipped to "+(o.getAttribute("aria-label")||n)))})});let m=null;function b(){clearTimeout(m),m=setTimeout(function(){!function(){const e=document.createElement("div");e.className="timeout-warning",e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.innerHTML='\n      <p>Your session will expire in 2 minutes due to inactivity.</p>\n      <button id="extend-session" type="button">Continue working (stay logged in)</button>\n    ',document.body.appendChild(e),document.getElementById("extend-session").addEventListener("click",function(){e.remove(),b(),announce("Session extended. You can continue working.")}),setTimeout(function(){document.body.contains(e)&&(announce("Session expired due to inactivity"),e.remove())},12e4)}()},108e4)}function g(){document.querySelectorAll('[role="dialog"], .modal').forEach(function(e){const t=document.querySelector('[data-opens="'+e.id+'"]');let n=null;function o(e){e.hidden=!0,e.setAttribute("aria-hidden","true"),n&&n.focus(),announce("Dialog closed")}e.addEventListener("keydown",function(t){"Escape"!==t.key?"Tab"===t.key&&function(e,t){const n=e.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'),o=n[0],d=n[n.length-1];t.shiftKey&&document.activeElement===o?(t.preventDefault(),d.focus()):t.shiftKey||document.activeElement!==d||(t.preventDefault(),o.focus())}(e,t):o(e)}),t&&t.addEventListener("click",function(){n=document.activeElement}),e.querySelectorAll("[data-closes], .modal-close").forEach(function(t){t.addEventListener("click",function(){o(e)})})})}["mousedown","keydown","scroll","touchstart"].forEach(function(e){document.addEventListener(e,b)}),b(),window.announce=function(e,t){t=t||"polite";let n=document.getElementById("aria-live-announcer");n||(n=document.createElement("div"),n.id="aria-live-announcer",n.className="sr-only",n.setAttribute("aria-live",t),n.setAttribute("aria-atomic","true"),document.body.appendChild(n)),n.textContent="",setTimeout(function(){n.textContent=e},100)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g();const v=document.getElementById("keyboard-shortcuts-btn");v&&v.addEventListener("click",function(){const e=document.createElement("div");e.className="shortcuts-panel",e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","shortcuts-title"),e.innerHTML='\n        <div class="shortcuts-content">\n          <h2 id="shortcuts-title">⌨️ Keyboard Shortcuts</h2>\n          <button class="close-shortcuts" aria-label="Close shortcuts panel">×</button>\n          <dl>\n            <dt>Alt + B</dt>\n            <dd>Take a break (5-minute timer)</dd>\n            \n            <dt>Alt + P</dt>\n            <dd>Toggle pain flare mode</dd>\n            \n            <dt>Alt + O</dt>\n            <dd>Toggle overwhelmed mode</dd>\n            \n            <dt>Alt + S</dt>\n            <dd>Reset energy counter</dd>\n            \n            <dt>Tab</dt>\n            <dd>Move to next interactive element</dd>\n            \n            <dt>Shift + Tab</dt>\n            <dd>Move to previous interactive element</dd>\n            \n            <dt>Enter / Space</dt>\n            <dd>Activate buttons and links</dd>\n            \n            <dt>Escape</dt>\n            <dd>Close modals and dialogs</dd>\n            \n            <dt>Arrow keys</dt>\n            <dd>Navigate through menus and lists</dd>\n          </dl>\n        </div>\n      ',document.body.appendChild(e),e.querySelector(".close-shortcuts").focus(),e.querySelector(".close-shortcuts").addEventListener("click",function(){e.remove(),v.focus()}),e.addEventListener("keydown",function(t){"Escape"===t.key&&(e.remove(),v.focus())})}),localStorage.getItem("keyboardShortcutsHintShown")||setTimeout(function(){announce("Press Alt + B for break mode, Alt + P for pain flare mode, Alt + O for overwhelmed mode"),localStorage.setItem("keyboardShortcutsHintShown","true")},5e3),window.toggleEmergencyMode=function(){"true"===document.body.getAttribute("data-emergency")?(document.body.removeAttribute("data-emergency"),announce("Emergency mode deactivated")):(document.body.setAttribute("data-emergency","true"),announce("Emergency mode activated","assertive"))}}();