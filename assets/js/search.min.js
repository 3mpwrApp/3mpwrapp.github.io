class SearchEngine{constructor(){this.index=null,this.documents=[],this.loaded=!1}async load(){if(!this.loaded)try{const e=await fetch("/search-index.json");return!!e.ok&&(this.index=await e.json(),this.documents=this.index.documents||[],this.loaded=!0,!0)}catch(e){return!1}}similarity(e,t){const s=e.length>t.length?e:t,o=e.length>t.length?t:e;if(0===s.length)return 1;const r=this.levenshteinDistance(s,o);return(s.length-r)/s.length}levenshteinDistance(e,t){const s=[];for(let e=0;e<=t.length;e++)s[e]=[e];for(let t=0;t<=e.length;t++)s[0][t]=t;for(let o=1;o<=t.length;o++)for(let r=1;r<=e.length;r++)t.charAt(o-1)===e.charAt(r-1)?s[o][r]=s[o-1][r-1]:s[o][r]=Math.min(s[o-1][r-1]+1,s[o][r-1]+1,s[o-1][r]+1);return s[t.length][e.length]}find(e,t={}){if(!this.loaded)return[];if(!e||""===e.trim())return[];const s=e.toLowerCase().trim(),o=[];for(const e of this.documents){let t=0;if(e.title.toLowerCase().includes(s))t+=50;else{const o=this.similarity(e.title.toLowerCase(),s);o>.7&&(t+=40*o)}e.excerpt.toLowerCase().includes(s)&&(t+=20),e.content.toLowerCase().includes(s)&&(t+=10);for(const o of e.tags)o.toLowerCase().includes(s)&&(t+=15);for(const o of e.categories)o.toLowerCase().includes(s)&&(t+=10);t>0&&o.push({...e,score:t})}o.sort((e,t)=>t.score!==e.score?t.score-e.score:new Date(t.date)-new Date(e.date));const r=t.limit||50;return o.slice(0,r)}filter(e={}){if(!this.loaded)return[];let t=[...this.documents];if(e.source&&(t=t.filter(t=>t.source===e.source)),e.category){const s=e.category.toLowerCase();t=t.filter(e=>e.categories.some(e=>e.toLowerCase()===s))}if(e.tag){const s=e.tag.toLowerCase();t=t.filter(e=>e.tags.some(e=>e.toLowerCase()===s))}if(e.after){const s=new Date(e.after);t=t.filter(e=>new Date(e.date)>=s)}if(e.before){const s=new Date(e.before);t=t.filter(e=>new Date(e.date)<=s)}t.sort((e,t)=>new Date(t.date)-new Date(e.date));const s=e.limit||50;return t.slice(0,s)}getTags(){if(!this.loaded)return[];const e=new Set;for(const t of this.documents)for(const s of t.tags)e.add(s);return Array.from(e).sort()}getCategories(){return this.loaded?Object.keys(this.index.categoryIndex||{}).sort():[]}getStats(){return this.loaded?{loaded:!0,totalDocuments:this.documents.length,generated:this.index.generated,version:this.index.version,sources:this.index.sources||{},categories:Object.keys(this.index.categoryIndex||{}),topTags:this.index.topTags||[]}:{loaded:!1}}getBySource(e){return this.filter({source:e})}getByCategory(e){return this.filter({category:e})}getByTag(e){return this.filter({tag:e})}getRecent(e=10){return[...this.documents].sort((e,t)=>new Date(t.date)-new Date(e.date)).slice(0,e)}findAdvanced(e,t={}){let s=e?this.find(e,t):this.documents;if(t.source&&(s=s.filter(e=>e.source===t.source)),t.category){const e=t.category.toLowerCase();s=s.filter(t=>t.categories.some(t=>t.toLowerCase()===e))}if(t.before){const e=new Date(t.before);s=s.filter(t=>new Date(t.date)<=e)}if(t.after){const e=new Date(t.after);s=s.filter(t=>new Date(t.date)>=e)}const o=t.limit||50;return s.slice(0,o)}}"undefined"!=typeof module&&module.exports&&(module.exports=SearchEngine);